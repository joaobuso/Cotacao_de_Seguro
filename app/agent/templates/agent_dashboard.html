{% extends "agent_base.html" %}

{% block title %}Dashboard do Agente - Equinos Seguros{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Dashboard do Agente</h2>
    <hr>

    <div class="row">
        <div class="col-md-6">
            <h4>Conversas Aguardando Atendimento</h4>
            {% if conversations_awaiting %}
                <ul class="list-group">
                    {% for conv in conversations_awaiting %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Usuário:</strong> {{ conv.phone_number }}<br>
                                <small>Última atualização: {{ conv.updated_at.strftime("%d/%m/%Y %H:%M") if conv.updated_at else "N/A" }}</small><br>
                                {% if conv.messages %}
                                    <small>Última msg: <em>{{ conv.messages[-1].text_content[:50] }}{% if conv.messages[-1].text_content|length > 50 %}...{% endif %}</em></small>
                                {% endif %}
                            </div>
                            <a href="{{ url_for(\'agent_bp.view_conversation\', conversation_id_str=conv._id) }}" class="btn btn-sm btn-primary">Ver / Assumir</a>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Nenhuma conversa aguardando atendimento no momento.</p>
            {% endif %}
        </div>

        <div class="col-md-6">
            <h4>Minhas Conversas Ativas</h4>
            {% if conversations_active %}
                <ul class="list-group">
                    {% for conv in conversations_active %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Usuário:</strong> {{ conv.phone_number }}<br>
                                <small>Última atualização: {{ conv.updated_at.strftime("%d/%m/%Y %H:%M") if conv.updated_at else "N/A" }}</small><br>
                                {% if conv.agent_id == session.get(\'agent_id\') %}
                                    <span class="badge badge-success">Atribuída a você</span>
                                {% else %}
                                     <span class="badge badge-info">Atribuída a: {{ conv.agent_id }}</span>
                                {% endif %}
                            </div>
                            <a href="{{ url_for(\'agent_bp.view_conversation\', conversation_id_str=conv._id) }}" class="btn btn-sm btn-info">Ver Conversa</a>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Nenhuma conversa ativa atribuída a você no momento.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

